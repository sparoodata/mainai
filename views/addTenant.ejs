<!-- /app/views/addtenant.ejs -->
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Add Tenant</title>
  <style>
    .form-group { margin-bottom: 15px; }
    .disabled { color: gray; }
  </style>
</head>
<body>
  <h1>➕ Add Tenant</h1>
  <form action="/submit-tenant/<%= authId %>" method="POST">
    <div class="form-group">
      <label for="tenantName">👤 Tenant Name:</label>
      <input type="text" id="tenantName" name="tenantName" required>
    </div>
    <div class="form-group">
      <label for="property">🏠 Property:</label>
      <select id="property" name="property" onchange="updateUnits()">
        <option value="">Select a property</option>
        <% properties.forEach(property => { %>
          <option value="<%= property._id %>"><%= property.name %> (📍 <%= property.address %>)</option>
        <% }); %>
      </select>
    </div>
    <div class="form-group">
      <label for="unitAssigned">🏡 Unit Assigned:</label>
      <select id="unitAssigned" name="unitAssigned" disabled>
        <option value="">Select a unit</option>
      </select>
    </div>
    <button type="submit">✅ Submit</button>
  </form>

  <script>
    const units = <%- JSON.stringify(units) %>;

    function updateUnits() {
      const propertyId = document.getElementById('property').value;
      const unitSelect = document.getElementById('unitAssigned');
      unitSelect.innerHTML = '<option value="">Select a unit</option>';
      unitSelect.disabled = !propertyId;

      if (propertyId) {
        const filteredUnits = units.filter(unit => unit.propertyId === propertyId);
        filteredUnits.forEach(unit => {
          const option = document.createElement('option');
          option.value = unit._id;
          option.text = unit.unitNumber + (unit.isAssigned ? ` (Assigned to ${unit.assignedTo})` : '');
          option.disabled = unit.isAssigned;
          if (unit.isAssigned) option.classList.add('disabled');
          unitSelect.appendChild(option);
        });
      }
    }
  </script>
</body>
</html>